(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();async function f(a){const t=`https://openlibrary.org/search.json?q=${encodeURIComponent(a)}`;try{const o=await fetch(t);if(!o.ok)throw new Error(`HTTP Error: ${o.status}`);return(await o.json()).docs.slice(0,20)}catch(o){throw console.error("Error fetching Open Library data:",o),o}}async function g(a,t){const s=`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(`${a} ${t}`)}`;try{const e=await fetch(s);if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);const r=await e.json();if(!r.items||!r.items.length)return null;const n=r.items[0].volumeInfo;return{title:n.title,author:n.authors?.join(", "),description:n.description,image:n.imageLinks?.thumbnail||"/public/placeholder.png",publishedDate:n.publishedDate}}catch(e){return console.error("Error fetching Google Books data:",e),null}}class y{constructor(){this.modal=null}async open(t,o,s){this.close(),this.modal=document.createElement("div"),this.modal.classList.add("modal"),this.modal.innerHTML=`
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="book-title">
        <button class="close-btn" aria-label="Close details">&times;</button>
        <img src="" alt="Book cover" class="detail-cover" id="detail-cover" />
        <div class="book-info">
          <h2 id="book-title">${o}</h2>
          <p class="meta"><strong>Author:</strong> ${s}</p>
          <p class="meta" id="published"></p>
          <p class="desc" id="description">Loading details...</p>
        </div>
      </div>
    `,document.body.appendChild(this.modal);const e=this.modal.querySelector(".close-btn"),r=this.modal.querySelector("#description"),n=this.modal.querySelector("#published"),c=this.modal.querySelector("#detail-cover");e.addEventListener("click",()=>this.close()),this.modal.addEventListener("click",i=>{i.target===this.modal&&this.close()}),document.addEventListener("keydown",i=>{i.key==="Escape"&&this.close()});try{const i=await g(o,s);if(!i){r.textContent="No extra details found for this book.",c.src="/public/placeholder.png";return}c.src=i.image||"/public/placeholder.png",c.alt=`${o} cover`,n.textContent=i.publishedDate?`Published: ${i.publishedDate}`:"",r.textContent=i.description||"No description available."}catch(i){console.error("Error loading book details:",i),r.textContent="Failed to load details."}}close(){this.modal&&(this.modal.remove(),this.modal=null)}}const v=new y;function b(a){const t=document.getElementById("results");if(t.innerHTML="",!a.length){t.innerHTML="<p>No results found. Try a different title or author.</p>";return}const o=document.createElement("div");o.classList.add("results-grid");const s=JSON.parse(localStorage.getItem("favorites"))||[];a.forEach(e=>{const r=e.cover_i?`https://covers.openlibrary.org/b/id/${e.cover_i}-M.jpg`:"/public/placeholder.png",n=e.title||"Untitled",c=e.author_name?e.author_name.join(", "):"Unknown Author",i=document.createElement("div");i.classList.add("book-card"),i.innerHTML=`
      <img src="${r}" alt="${n}" class="book-cover" />
      <h3>${n}</h3>
      <p>${c}</p>
      <div class="card-actions">
        <button class="details-btn" data-key="${e.key}">View Details</button>
        <button class="fav-btn">★ Favorite</button>
      </div>
    `,i.querySelector(".details-btn").addEventListener("click",()=>{v.open(e.key,n,c)}),i.querySelector(".fav-btn").addEventListener("click",async()=>{if(s.some(l=>l.title===n)){alert(`"${n}" is already in your favorites.`);return}let m="Unavailable";try{const l=await fetch(`https://openlibrary.org${e.key}.json`);if(l.ok){const d=await l.json();(d.isbn_13||d.isbn_10)&&(m=d.isbn_13?d.isbn_13[0]:d.isbn_10[0])}}catch(l){console.warn("Error fetching ISBN:",l)}const p={title:n,author:c,isbn:m};s.push(p),localStorage.setItem("favorites",JSON.stringify(s));const h=s.map(l=>`${l.title} — ${l.author} (ISBN: ${l.isbn})`).join(`
`);await navigator.clipboard.writeText(h),alert(`"${n}" added to favorites!
Full list copied to clipboard.`)}),o.appendChild(i)}),t.appendChild(o)}const E=document.getElementById("search-form"),L=document.getElementById("search-input");E.addEventListener("submit",async a=>{a.preventDefault();const t=L.value.trim(),o=document.getElementById("results");if(!t){o.innerHTML="<p>Please enter a title or author.</p>";return}o.innerHTML='<p class="loading">Searching...</p>';try{const s=await f(t);b(s)}catch(s){console.error(s),o.innerHTML='<p class="error">Failed to load results. Please try again.</p>'}});const w=document.getElementById("menu-toggle"),u=document.getElementById("nav-menu");w.addEventListener("click",()=>{u.classList.toggle("open")});u.querySelectorAll("a").forEach(a=>{a.addEventListener("click",()=>u.classList.remove("open"))});document.addEventListener("click",a=>{const t=document.querySelector(".modal");t&&a.target===t&&t.remove()});document.addEventListener("keydown",a=>{if(a.key==="Escape"){const t=document.querySelector(".modal");t&&t.remove()}});
